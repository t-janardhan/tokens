<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Token Display</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
        }

        /* Layout */
        .tv {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .board {
            width: 60%;
            perspective: 1000px;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* List Item */
        li {
            font-size: 38px;
            padding: 14px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            opacity: 0;
        }

        /* READY */
        .ready {
            color: #00ff9c;
            font-weight: bold;
        }

        /* ================= BUTTON ================= */
        .audio-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 20px;
            padding: 12px 24px;
            cursor: pointer;
            z-index: 200;
        }

        /* ================= ANIMATIONS ================= */

        /* Flip IN */
        .flip-in {
            animation: flipIn 0.7s forwards;
            transform-origin: top;
        }

        @keyframes flipIn {
            from {
                opacity: 0;
                transform: rotateX(90deg);
            }

            to {
                opacity: 1;
                transform: rotateX(0);
            }
        }

        /* Fade IN (optional) */
        .fade-in {
            animation: fadeIn 0.6s forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Slide OUT */
        .slide-out {
            animation: slideOut 0.4s forwards;
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }

            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }
    </style>
</head>

<body>

    <button id="audioBtn" class="audio-btn">ðŸ”Š Start Audio</button>

    <div class="tv">
        <div class="board">
            <ul id="list"></ul>
        </div>
    </div>

    <script>
        /* ================= CONFIG ================= */
        const RECORDS_PER_PAGE = 6;
        const PAGE_INTERVAL = 5000;
        const ANIMATION_TYPE = "flip"; // "flip" | "fade"

        /* ================= DATA ================= */
        const tokenData = Array.from({ length: 35 }, (_, i) => ({
            token: i + 1,
            status: (i % 3 === 1) ? "READY" : "WAITING"
        }));

        /* ================= STATE ================= */
        const list = document.getElementById("list");
        const audioBtn = document.getElementById("audioBtn");

        let pageIndex = 0;
        let isAudioEnabled = false;
        let voices = [];
        let queue = [];
        let announced = new Set();

        /* ================= RENDER ================= */
        function renderPage() {

            const oldItems = [...list.children];

            // OUT animation
            oldItems.forEach((li, i) => {
                li.classList.add("slide-out");
                li.style.animationDelay = `${i * 0.05}s`;
            });

            // After OUT, render new records
            setTimeout(() => {
                list.innerHTML = "";

                tokenData
                    .slice(pageIndex, pageIndex + RECORDS_PER_PAGE)
                    .forEach((item, i) => {

                        const li = document.createElement("li");

                        li.className =
                            ANIMATION_TYPE === "flip" ? "flip-in" : "fade-in";

                        li.style.animationDelay = `${i * 0.12}s`;

                        li.innerHTML = `
                    <span>Token ${String(item.token).padStart(2, "0")}</span>
                    <span class="${item.status === "READY" ? "ready" : ""}">
                        ${item.status}
                    </span>
                `;

                        list.appendChild(li);
                    });

            }, 450);
        }

        /* Initial render */
        renderPage();

        /* Page rotation */
        setInterval(() => {
            pageIndex += RECORDS_PER_PAGE;
            if (pageIndex >= tokenData.length) pageIndex = 0;
            renderPage();
        }, PAGE_INTERVAL);

        /* ================= AUDIO ================= */
        audioBtn.onclick = () => {
            isAudioEnabled = true;
            audioBtn.style.display = "none";   // ðŸ‘ˆ HIDE BUTTON
            startAnnouncements();
        };

        function startAnnouncements() {
            voices = speechSynthesis.getVoices();
            queue = [];

            tokenData.forEach(item => {
                if (item.status === "READY" && !announced.has(item.token)) {
                    announced.add(item.token);
                    queue.push(item.token);
                }
            });

            speakNext();
        }

        speechSynthesis.onvoiceschanged = () => {
            voices = speechSynthesis.getVoices();
        };

        function speakNext() {
            if (!isAudioEnabled || !queue.length) return;

            const token = queue.shift();
            const counter = Math.floor(Math.random() * 6) + 1;

            const msg = new SpeechSynthesisUtterance(
                `Token number ${token}. Your order is ready. Please collect at counter ${counter}.`
            );

            msg.voice =
                voices.find(v => v.name.toLowerCase().includes("female")) ||
                voices[0];

            msg.rate = 0.9;
            msg.onend = () => setTimeout(speakNext, 2000);

            speechSynthesis.speak(msg);
        }
    </script>

</body>

</html>